<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - 로또 분석기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .flash-message { cursor: pointer; }
        /* Active Link Styling */
        .nav-link-active {
            color: #7c3aed; /* purple-600 */
            font-weight: 700; /* Bold */
            border-bottom: 3px solid #7c3aed; /* 밑줄 굵게 */
            padding-bottom: 13px !important; /* 밑줄 때문에 패딩 조정 */
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('index') }}" class="flex items-center">
                        <img src="{{ url_for('static', filename='logo.jpg') }}"
                             alt="Logo"
                             class="h-16 w-auto object-contain hover:opacity-90 transition duration-150">
                    </a>
                </div>
                <div class="flex items-center space-x-4 h-full">
                    <!-- Nav Links -->                    
                    {% set current_path = request.path %}
                    
                    <!-- 당첨번호 -->
                    {% set lotto_data_url = url_for('lotto_data') %}
                    <a href="{{ lotto_data_url }}" class="
                        text-gray-700 hover:text-purple-600 px-4 pt-3 pb-3 text-sm font-semibold transition duration-150
                        {% if current_path == lotto_data_url %}nav-link-active{% endif %}
                    ">당첨번호</a>

                    <!-- 로그인 상태에 따른 메뉴 -->
                    {% if 'user_id' in session %}
                        
                        <!-- 내 번호 관리 -->
                        {% set my_picks_url = url_for('my_picks') %}
                        <a href="{{ my_picks_url }}" class="
                            text-gray-700 hover:text-purple-600 px-4 pt-3 pb-3 text-sm font-semibold transition duration-150
                            {% if current_path == my_picks_url %}nav-link-active{% endif %}
                        ">내 번호 관리</a>

                        <!-- 번호 추천 -->
                        {% set recommend_url = url_for('recommend_page') %}
                        <a href="{{ recommend_url }}" class="
                            text-gray-700 hover:text-purple-600 px-4 pt-3 pb-3 text-sm font-semibold transition duration-150
                            {% if current_path == recommend_url %}nav-link-active{% endif %}
                        ">번호 추천</a>
                        
                        <!-- 통계 관리 (관리자 전용) -->
                        {% if session.get('status') == 'admin' %}
                        {% set admin_stats_url = url_for('admin_stats_management') %}
                        <a href="{{ admin_stats_url }}" class="
                            text-red-600 hover:text-red-800 px-4 pt-3 pb-3 text-sm font-bold border border-red-200 bg-red-50 rounded-lg transition duration-150
                            {% if current_path == admin_stats_url or 'statistics' in current_path %}nav-link-active !border-b-2 !border-red-600 !bg-red-100{% endif %}
                        ">통계 관리</a>
                        {% endif %}
                        
                        <!-- 마이페이지 및 로그아웃 -->
                        {% set mypage_url = url_for('mypage') %}
                        <a href="{{ mypage_url }}" class="
                            text-gray-700 hover:text-purple-600 px-4 pt-3 pb-3 text-sm font-semibold transition duration-150
                            {% if current_path == mypage_url %}nav-link-active{% endif %}
                        ">마이페이지 ({{ session.username }})</a>
                        
                        <!-- 로그아웃 버튼 -->
                        <a href="{{ url_for('logout') }}" class="bg-purple-500 text-white hover:bg-purple-600 px-4 py-2 rounded-lg text-sm font-semibold transition duration-150 shadow">로그아웃</a>
                    {% else %}
                        <!-- 로그인 링크 -->
                        {% set login_url = url_for('login') %}
                        <a href="{{ login_url }}" class="
                            text-gray-700 hover:text-purple-600 px-4 pt-3 pb-3 text-sm font-semibold transition duration-150
                            {% if current_path == login_url %}nav-link-active{% endif %}
                        ">로그인</a>
                        
                        <!-- 회원가입 버튼 -->
                        {% set signup_url = url_for('signup') %}
                        <a href="{{ signup_url }}" class="
                            bg-green-500 text-white hover:bg-green-600 px-4 py-2 rounded-lg text-sm font-semibold transition duration-150 shadow
                            {{ ' !bg-green-600' if current_path == signup_url }}
                        ">회원가입</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    <div id="flash-container" class="fixed top-16 left-1/2 transform -translate-x-1/2 z-20 w-full max-w-sm sm:max-w-md mt-2">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div onclick="this.remove()" class="flash-message mb-2 p-4 rounded-lg shadow-xl text-sm font-medium transition-opacity duration-300 opacity-100 
                    {% if category == 'error' %}bg-red-500 text-white{% elif category == 'success' %}bg-green-500 text-white{% else %}bg-blue-500 text-white{% endif %}" role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Main Content -->
    <main class="flex-grow py-8 px-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-4 mt-auto">
        <div class="max-w-7xl mx-auto text-center text-sm">
            &copy; 2025 Lotto Analyzer. Powered by Flask.
        </div>
    </footer>
</body>
</html>